{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ product.title }} - {{ product.category.title }} | PackAxis Packaging{% endblock %}

{% block content %}
<!-- Product Detail Section -->
<section class="product-detail-section">
    <div class="container">
        <div class="product-detail-wrapper">
            <!-- Image Gallery (Left Side) -->
            <div class="product-gallery-left">
                <!-- Vertical Thumbnails -->
                {% if product_images|length > 1 %}
                <div class="thumbnail-gallery-vertical">
                    {% for img in product_images %}
                        <div class="thumbnail-item-vertical {% if forloop.first %}active{% endif %}" onclick="changeImage('{{ img.url }}', this)">
                            <img src="{{ img.url }}" alt="{{ img.alt }}">
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Main Image -->
                <div class="main-image-container-left">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.title }}" class="main-product-image" id="mainImage">
                    {% else %}
                        <div class="image-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Product Info (Right Side) -->
            <div class="product-info-right">
                <!-- Availability Badge -->
                <div class="availability-badge {% if product.track_inventory and product.stock_quantity <= 0 and not product.allow_backorder %}out-of-stock{% endif %}">
                    <span class="badge-dot"></span>
                    {% if product.track_inventory %}
                        {% if product.stock_quantity > 0 %}
                            <span>In Stock ({{ product.stock_quantity }} available)</span>
                        {% elif product.allow_backorder %}
                            <span>Available on Backorder</span>
                        {% else %}
                            <span>Out of Stock</span>
                        {% endif %}
                    {% else %}
                        <span>In Stock & Ready to Ship</span>
                    {% endif %}
                </div>
                
                <h1 class="product-title-main">{{ product.title }}</h1>
                
                <!-- SKU -->
                <div class="product-sku">
                    {% if product.sku %}
                    <span>SKU: {{ product.sku }}</span>
                    {% else %}
                    <span>SKU: {{ product.slug|upper }}</span>
                    {% endif %}
                </div>
                
                <!-- Pricing -->
                <div class="product-pricing-main">
                    {% if product.price %}
                        <span class="price-current">${{ product.price }}</span>
                        {% if product.compare_at_price and product.compare_at_price > product.price %}
                            <span class="price-compare">${{ product.compare_at_price }}</span>
                            <span class="price-discount">Save {{ product.discount_percentage }}%</span>
                        {% endif %}
                        {% if product.price_per %}
                            <span class="price-unit">{{ product.price_per }}</span>
                        {% endif %}
                    {% elif product.price_range %}
                        <span class="price-current">{{ product.price_range }}</span>
                        {% if product.minimum_order %}
                            <span class="price-unit">Min. {{ product.minimum_order }} pcs</span>
                        {% endif %}
                    {% endif %}
                </div>

                <!-- Size/Specifications Quick View -->
                {% if product.size or product.color %}
                <div class="product-options">
                    {% if product.size %}
                    <div class="option-group">
                        <label>Size</label>
                        <div class="option-value">{{ product.size }}</div>
                    </div>
                    {% endif %}
                    {% if product.color %}
                    <div class="option-group">
                        <label>Color</label>
                        <div class="option-value">{{ product.color }}</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Quantity Selector -->
                <form action="{% url 'core:add_to_cart' product.slug %}" method="POST" class="add-to-cart-form">
                    {% csrf_token %}
                    <div class="quantity-section">
                        <label>Quantity{% if product.case_quantity %} ({{ product.case_quantity }} per case){% endif %}</label>
                        <div class="quantity-selector">
                            <button type="button" class="qty-btn minus" onclick="decrementQty()">-</button>
                            <input type="number" name="quantity" id="quantity" value="{% if product.minimum_order %}{{ product.minimum_order }}{% else %}1{% endif %}" min="{% if product.minimum_order %}{{ product.minimum_order }}{% else %}1{% endif %}">
                            <button type="button" class="qty-btn plus" onclick="incrementQty()">+</button>
                        </div>
                        {% if product.minimum_order %}
                        <span class="min-order-note">Min. order: {{ product.minimum_order }} pcs</span>
                        {% endif %}
                    </div>

                    <!-- CTA Buttons -->
                    <div class="product-actions-main">
                        {% if product.price %}
                            <!-- E-commerce mode: Add to Cart -->
                            {% if product.is_in_stock or product.allow_backorder %}
                            <button type="submit" class="btn-add-cart">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="m1 1 4 4 14 1-2 9H7"></path>
                                </svg>
                                ADD TO CART
                            </button>
                            {% else %}
                            <button type="button" class="btn-add-cart out-of-stock" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                </svg>
                                OUT OF STOCK
                            </button>
                            {% endif %}
                        {% else %}
                            <!-- Quote mode: Get a Quote -->
                            <a href="{% url 'core:quote_request' %}" class="btn-add-cart">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                </svg>
                                GET A QUOTE
                            </a>
                        {% endif %}
                        <a href="tel:+14164004747" class="btn-call" title="Call us now">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                        </a>
                    </div>
                </form>

                <!-- Trust Badges - Compact -->
                <div class="trust-badges-compact">
                    <div class="badge-compact">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="3" width="15" height="13" rx="2" ry="2"></rect>
                            <polyline points="16 8 20 8 23 11 23 16 20 16"></polyline>
                            <circle cx="5.5" cy="18.5" r="2.5"></circle>
                            <circle cx="18.5" cy="18.5" r="2.5"></circle>
                        </svg>
                        <div>
                            <strong>Free Shipping</strong>
                            <span>On orders $2000+</span>
                        </div>
                    </div>
                    <div class="badge-compact">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            <polyline points="9 12 11 14 15 10"></polyline>
                        </svg>
                        <div>
                            <strong>100% Secure</strong>
                            <span>Shop with confidence</span>
                        </div>
                    </div>
                    <div class="badge-compact">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <div>
                            <strong>Quick Response</strong>
                            <span>Within 24 hours</span>
                        </div>
                    </div>
                </div>
                
                <!-- Guarantee Banner -->
                <div class="guarantee-banner">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="7"></circle>
                        <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
                    </svg>
                    <span><strong>Quality Guaranteed</strong> â€” 100% satisfaction or we'll make it right</span>
                </div>
            </div>
        </div>
        
        <!-- Product Details Tabs (Full Width Below) -->
        <div class="product-tabs-section">
            <div class="tabs-nav">
                <button class="tab-btn active" onclick="switchTab(event, 'description')">Description</button>
                <button class="tab-btn" onclick="switchTab(event, 'specifications')">Specifications</button>
                {% if features %}
                <button class="tab-btn" onclick="switchTab(event, 'features')">Key Features</button>
                {% endif %}
            </div>
            
            <div class="tabs-content">
                <!-- Description Tab -->
                <div id="description" class="tab-panel active">
                    {% if product.description %}
                        <p>{{ product.description }}</p>
                    {% else %}
                        <p>Premium quality packaging solution designed for your business needs. Contact us for detailed product information.</p>
                    {% endif %}
                </div>
                
                <!-- Specifications Tab -->
                <div id="specifications" class="tab-panel">
                    {% if specifications %}
                        <ul class="spec-list-tab">
                            {% for spec in specifications %}
                            <li>
                                <strong>{{ spec.label }}:</strong> {{ spec.value }}
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>Contact us for detailed specifications.</p>
                    {% endif %}
                </div>
                
                <!-- Features Tab -->
                {% if features %}
                <div id="features" class="tab-panel">
                    <ul class="features-list-tab">
                        {% for feature in features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>


<!-- Related Products -->
{% if related_products %}
<section class="related-products-section">
    <div class="container">
        <h2 class="section-title">You may also like</h2>
        <div class="related-products-grid">
            {% for related in related_products %}
            <a href="{% url 'core:product_detail' related.slug %}" class="related-product-card">
                {% if related.image %}
                    <div class="related-product-image">
                        <img src="{{ related.image.url }}" alt="{{ related.title }}">
                    </div>
                {% endif %}
                <div class="related-product-info">
                    <h3>{{ related.title }}</h3>
                    {% if related.price_range %}
                        <p class="related-price">{{ related.price_range }}</p>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<script>
// Image gallery switcher
function changeImage(imageUrl, thumbnail) {
    document.getElementById('mainImage').src = imageUrl;
    document.querySelectorAll('.thumbnail-item-vertical').forEach(item => {
        item.classList.remove('active');
    });
    thumbnail.classList.add('active');
}

// Quantity controls
function incrementQty() {
    const qtyInput = document.getElementById('quantity');
    qtyInput.value = parseInt(qtyInput.value) + 1;
}

function decrementQty() {
    const qtyInput = document.getElementById('quantity');
    if (parseInt(qtyInput.value) > 1) {
        qtyInput.value = parseInt(qtyInput.value) - 1;
    }
}

// Tab switcher
function switchTab(event, tabId) {
    // Remove active from all tabs and panels
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    
    // Add active to clicked tab and corresponding panel
    event.target.classList.add('active');
    document.getElementById(tabId).classList.add('active');
}
</script>
{% endblock %}
