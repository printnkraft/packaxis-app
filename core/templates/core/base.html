{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PackAxis - Brown Kraft Paper Bags Wholesale Canada | Eco-Friendly Packaging Toronto{% endblock %}</title>
    <meta name="description" content="{% block description %}Canada's #1 supplier of brown kraft paper bags in bulk. Eco-friendly, biodegradable kraft bags with custom branding options. Wholesale pricing for restaurants, grocery stores, and retailers across Toronto and Canada.{% endblock %}">
    <link rel="icon" type="image/png" href="{% static 'images/packaxis-fav.png' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo-container">
                    <a href="{% url 'core:index' %}"><img src="{% static 'images/assests/packaxis logo.png' %}" alt="PackAxis Packaging Canada - Custom Paper Bags Manufacturer" class="logo"></a>
                </div>
                <ul class="nav-menu">
                    <li><a href="{% url 'core:index' %}" class="nav-link">Home</a></li>
                    {% for item in menu_items %}
                        {% if item.has_children %}
                            <li class="nav-item-dropdown">
                                <a href="{% if item.url %}{{ item.url }}{% else %}#{% endif %}" class="nav-link">{{ item.title }}</a>
                                <ul class="dropdown-menu">
                                    {% for child in item.children.all %}
                                        {% if child.is_active %}
                                            <li><a href="{{ child.url }}"{% if child.open_in_new_tab %} target="_blank"{% endif %}>{{ child.title }}</a></li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </li>
                        {% else %}
                            <li><a href="{{ item.url }}" class="nav-link"{% if item.open_in_new_tab %} target="_blank"{% endif %}>{{ item.title }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <div class="nav-actions">
                    <div class="nav-cart-wrapper">
                        <a href="{% url 'core:cart' %}" class="nav-cart-link" title="Shopping Cart">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <path d="M16 10a4 4 0 0 1-8 0"></path>
                            </svg>
                            {% if cart_total_items %}<span class="cart-badge">{{ cart_total_items }}</span>{% endif %}
                        </a>
                        <div class="cart-dropdown">
                            {% if cart_items_preview %}
                                <div class="cart-dropdown-items">
                                    {% for item in cart_items_preview %}
                                    <div class="cart-dropdown-item" data-item-id="{{ item.id }}">
                                        {% if item.product.image %}
                                        <img src="{{ item.product.image.url }}" alt="{{ item.product.title }}" class="cart-dropdown-img">
                                        {% else %}
                                        <div class="cart-dropdown-img cart-dropdown-placeholder">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
                                        </div>
                                        {% endif %}
                                        <div class="cart-dropdown-info">
                                            <span class="cart-dropdown-name">{{ item.product.title|truncatechars:22 }}</span>
                                            <div class="cart-dropdown-controls">
                                                <div class="cart-dropdown-qty-control">
                                                    <button type="button" class="cart-qty-btn minus" onclick="updateCartDropdown({{ item.id }}, -1)">âˆ’</button>
                                                    <span class="cart-qty-value">{{ item.quantity }}</span>
                                                    <button type="button" class="cart-qty-btn plus" onclick="updateCartDropdown({{ item.id }}, 1)">+</button>
                                                </div>
                                                <span class="cart-dropdown-price">${{ item.line_total }}</span>
                                            </div>
                                        </div>
                                        <button type="button" class="cart-dropdown-remove" onclick="removeFromCartDropdown({{ item.id }})" title="Remove">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                        </button>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% if cart_total_items > 3 %}
                                <div class="cart-dropdown-more">+ {{ cart_total_items|add:"-3" }} more item{{ cart_total_items|add:"-3"|pluralize }}</div>
                                {% endif %}
                                <div class="cart-dropdown-footer">
                                    <div class="cart-dropdown-subtotal">
                                        <span>Subtotal:</span>
                                        <strong>${{ cart_subtotal }}</strong>
                                    </div>
                                    <a href="{% url 'core:cart' %}" class="cart-dropdown-btn">View Cart</a>
                                </div>
                            {% else %}
                                <div class="cart-dropdown-empty">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                                    <p>Your cart is empty</p>
                                    <a href="{% url 'core:products' %}" class="cart-dropdown-shop">Shop Now</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- User Account Section -->
                    {% if user.is_authenticated %}
                    <div class="nav-user-wrapper">
                        <button class="nav-user-btn" title="My Account">
                            <span class="nav-user-avatar">{{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}</span>
                        </button>
                        <div class="user-dropdown">
                            <div class="user-dropdown-header">
                                <span class="user-dropdown-name">{{ user.first_name }} {{ user.last_name }}</span>
                                <span class="user-dropdown-email">{{ user.email }}</span>
                            </div>
                            <div class="user-dropdown-links">
                                <a href="{% url 'accounts:profile' %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                    My Profile
                                </a>
                                <a href="{% url 'accounts:order_history' %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                                    Order History
                                </a>
                                <a href="{% url 'accounts:signout' %}" class="user-dropdown-signout">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                    Sign Out
                                </a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'accounts:signin' %}" class="nav-signin-btn" title="Sign In">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </a>
                    {% endif %}
                </div>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock %}

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <img src="{% static 'images/assests/packaxis logo.png' %}" alt="PackAxis - Eco-Friendly Paper Bags Canada" class="footer-logo">
                    <p>Canada's premier supplier of brown kraft paper bags in bulk. Specializing in eco-friendly, biodegradable kraft bags with custom branding options for restaurants, grocery stores, and retailers across Toronto and nationwide.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/people/PackAxis-Packaging/61584632132597/" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/>
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/company/packaxis" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="{% url 'core:index' %}">Home</a></li>
                        <li><a href="{% url 'core:products' %}">Products</a></li>
                        <li><a href="{% url 'blog:blog_list' %}">Blog</a></li>
                        <li><a href="{% url 'core:faq' %}">FAQ</a></li>
                        <li><a href="{% url 'core:index' %}#about">About</a></li>
                        <li><a href="{% url 'core:index' %}#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Product Categories</h4>
                    <ul>
                        {% for product_category in product_categories %}
                        <li><a href="{% url 'core:product_detail' product_category.slug %}">{{ product_category.title }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact</h4>
                    <ul>
                        <li><a href="https://maps.google.com/?q=135+Eighth+St,+Toronto,+ON+M8V+3C8" target="_blank">135 Eighth St, Toronto, ON M8V 3C8</a></li>
                        <li><a href="tel:+12499892496">+1 (249) 989-2496</a></li>
                        <li><a href="tel:+16475948751">+1 (647) 594-8751</a></li>
                        <li><a href="mailto:hello@packaxis.ca">hello@packaxis.ca</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <p>&copy; 2025 PackAxis Packaging Canada. All rights reserved.</p>
                    <div class="footer-links">
                        <a href="{% url 'core:privacy_policy' %}">Privacy Policy</a>
                        <a href="{% url 'core:terms_of_service' %}">Terms of Service</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Custom Modal Component -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-backdrop"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-icon" id="modalIcon"></div>
            <h3 class="custom-modal-title" id="modalTitle">Confirm</h3>
            <p class="custom-modal-message" id="modalMessage">Are you sure?</p>
            <div class="custom-modal-actions">
                <button type="button" class="modal-btn modal-btn-cancel" id="modalCancel">Cancel</button>
                <button type="button" class="modal-btn modal-btn-confirm" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>
    
    <style>
    /* Custom Modal Styles */
    .custom-modal {
        position: fixed;
        inset: 0;
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
    }
    
    .custom-modal.show {
        opacity: 1;
        visibility: visible;
    }
    
    .custom-modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }
    
    .custom-modal-content {
        position: relative;
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 380px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.2s ease;
    }
    
    .custom-modal.show .custom-modal-content {
        transform: scale(1) translateY(0);
    }
    
    .custom-modal-icon {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        margin: 0 auto 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .custom-modal-icon.confirm {
        background: #fff3e0;
        color: #e65100;
    }
    
    .custom-modal-icon.success {
        background: #e8f5e9;
        color: #2e7d32;
    }
    
    .custom-modal-icon.error {
        background: #ffebee;
        color: #c62828;
    }
    
    .custom-modal-icon.info {
        background: #e3f2fd;
        color: #1565c0;
    }
    
    .custom-modal-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f1f1f;
        margin-bottom: 0.5rem;
    }
    
    .custom-modal-message {
        font-size: 0.9375rem;
        color: #666;
        line-height: 1.5;
        margin-bottom: 1.5rem;
    }
    
    .custom-modal-actions {
        display: flex;
        gap: 0.75rem;
    }
    
    .modal-btn {
        flex: 1;
        padding: 0.75rem 1.25rem;
        border-radius: 50px;
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
    }
    
    .modal-btn-cancel {
        background: #f5f5f5;
        color: #666;
    }
    
    .modal-btn-cancel:hover {
        background: #e5e5e5;
    }
    
    .modal-btn-confirm {
        background: var(--primary-color);
        color: white;
    }
    
    .modal-btn-confirm:hover {
        background: var(--secondary-color);
    }
    
    .modal-btn-confirm.danger {
        background: #dc3545;
    }
    
    .modal-btn-confirm.danger:hover {
        background: #c82333;
    }
    
    /* Single button (for alerts) */
    .custom-modal-actions.single {
        justify-content: center;
    }
    
    .custom-modal-actions.single .modal-btn {
        flex: none;
        min-width: 120px;
    }
    </style>

    <!-- Global Modal Functions -->
    <script>
    // Custom Modal Functions
    const customModal = {
        modal: null,
        
        init() {
            this.modal = document.getElementById('customModal');
            this.backdrop = this.modal.querySelector('.custom-modal-backdrop');
            this.icon = document.getElementById('modalIcon');
            this.title = document.getElementById('modalTitle');
            this.message = document.getElementById('modalMessage');
            this.actions = this.modal.querySelector('.custom-modal-actions');
            this.cancelBtn = document.getElementById('modalCancel');
            this.confirmBtn = document.getElementById('modalConfirm');
            
            // Close on backdrop click
            this.backdrop.addEventListener('click', () => this.close());
            
            // Close on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.modal.classList.contains('show')) {
                    this.close();
                }
            });
        },
        
        show(options) {
            const { type = 'confirm', title, message, confirmText = 'Confirm', cancelText = 'Cancel', danger = false } = options;
            
            // Set icon based on type
            const icons = {
                confirm: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
                success: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
                error: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
                info: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`,
                delete: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>`
            };
            
            this.icon.innerHTML = icons[type] || icons.confirm;
            this.icon.className = 'custom-modal-icon ' + (type === 'delete' ? 'error' : type);
            this.title.textContent = title;
            this.message.textContent = message;
            this.confirmBtn.textContent = confirmText;
            this.cancelBtn.textContent = cancelText;
            
            // Apply danger style
            if (danger || type === 'delete') {
                this.confirmBtn.classList.add('danger');
            } else {
                this.confirmBtn.classList.remove('danger');
            }
            
            // Show modal
            this.modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            return new Promise((resolve) => {
                this.confirmBtn.onclick = () => {
                    this.close();
                    resolve(true);
                };
                this.cancelBtn.onclick = () => {
                    this.close();
                    resolve(false);
                };
            });
        },
        
        alert(options) {
            const { type = 'info', title, message, buttonText = 'OK' } = options;
            
            const icons = {
                success: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
                error: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
                info: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`,
                warning: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`
            };
            
            this.icon.innerHTML = icons[type] || icons.info;
            this.icon.className = 'custom-modal-icon ' + type;
            this.title.textContent = title;
            this.message.textContent = message;
            this.confirmBtn.textContent = buttonText;
            this.confirmBtn.classList.remove('danger');
            
            // Hide cancel button for alerts
            this.cancelBtn.style.display = 'none';
            this.actions.classList.add('single');
            
            this.modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            return new Promise((resolve) => {
                this.confirmBtn.onclick = () => {
                    this.close();
                    resolve(true);
                };
            });
        },
        
        close() {
            this.modal.classList.remove('show');
            document.body.style.overflow = '';
            // Reset cancel button visibility
            this.cancelBtn.style.display = '';
            this.actions.classList.remove('single');
        }
    };
    
    // Initialize modal on DOM ready
    document.addEventListener('DOMContentLoaded', () => customModal.init());
    
    // Global helper functions
    async function showConfirm(title, message, confirmText = 'Confirm', cancelText = 'Cancel') {
        return customModal.show({ type: 'confirm', title, message, confirmText, cancelText });
    }
    
    async function showDeleteConfirm(title, message) {
        return customModal.show({ type: 'delete', title, message, confirmText: 'Remove', cancelText: 'Cancel', danger: true });
    }
    
    async function showAlert(type, title, message) {
        return customModal.alert({ type, title, message });
    }
    </script>

    <!-- Cart Dropdown Functions -->
    <script>
    async function refreshCartDropdown() {
        try {
            const response = await fetch('/cart/dropdown-html/');
            const html = await response.text();
            const dropdown = document.querySelector('.cart-dropdown');
            if (dropdown) {
                dropdown.innerHTML = html;
            }
        } catch (error) {
            console.error('Error refreshing cart dropdown:', error);
        }
    }

    function updateCartBadge(totalItems) {
        const badge = document.querySelector('.cart-badge');
        const cartLink = document.querySelector('.nav-cart-link');
        
        if (totalItems > 0) {
            if (badge) {
                badge.textContent = totalItems;
            } else if (cartLink) {
                const newBadge = document.createElement('span');
                newBadge.className = 'cart-badge';
                newBadge.textContent = totalItems;
                cartLink.appendChild(newBadge);
            }
        } else {
            if (badge) {
                badge.remove();
            }
        }
    }

    async function updateCartDropdown(itemId, change) {
        const itemEl = document.querySelector(`.cart-dropdown-item[data-item-id="${itemId}"]`);
        const qtyBtn = itemEl ? itemEl.querySelector('.cart-qty-btn') : null;
        
        // Show loading state
        if (qtyBtn) {
            qtyBtn.disabled = true;
        }
        
        try {
            const response = await fetch(`/cart/update-ajax/${itemId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ change: change })
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Update the cart badge
                updateCartBadge(data.cart_total_items);
                
                // Refresh the dropdown HTML
                await refreshCartDropdown();
            } else if (data.error) {
                showAlert('error', 'Error', data.error);
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('error', 'Error', 'Something went wrong. Please try again.');
        }
    }

    async function removeFromCartDropdown(itemId) {
        const confirmed = await showDeleteConfirm('Remove Item', 'Are you sure you want to remove this item from your cart?');
        if (confirmed) {
            const itemEl = document.querySelector(`.cart-dropdown-item[data-item-id="${itemId}"]`);
            
            // Add fade out animation
            if (itemEl) {
                itemEl.style.opacity = '0.5';
                itemEl.style.pointerEvents = 'none';
            }
            
            try {
                const response = await fetch(`/cart/remove-ajax/${itemId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Update the cart badge
                    updateCartBadge(data.cart_total_items);
                    
                    // Refresh the dropdown HTML
                    await refreshCartDropdown();
                } else if (data.error) {
                    showAlert('error', 'Error', data.error);
                    if (itemEl) {
                        itemEl.style.opacity = '1';
                        itemEl.style.pointerEvents = 'auto';
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'Error', 'Something went wrong. Please try again.');
                if (itemEl) {
                    itemEl.style.opacity = '1';
                    itemEl.style.pointerEvents = 'auto';
                }
            }
        }
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    </script>

    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/69235a09713892195f83790b/1jap1fdej';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->

    <script src="{% static 'js/script.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
